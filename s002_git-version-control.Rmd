# Introduction to GitHub and Version Control

__Announcements__:

- The first assignment is due for peer review on Monday, final on Wednesday
- The first peer review is due on Tuesday


## Outline

We'll cover four topics today:

- Git and GitHub
- Version control
- Submitting assignments
- Asking questions


## Learning Objectives

By the end of today's class, you will be able to:

- Understand the benefits of a version control workflow 
- Commit file changes to GitHub
- Open and respond to pull requests on GitHub
- Navigate the commit history of a repository and a file on GitHub


## Resources

If you want to learn more about today's topics, check out:

- The [GitHub guide](https://guides.github.com/) has lots of info about GitHub.
  If you do go here, I recommend you start with "Hello, World!"](https://guides.github.com/activities/hello-world/). 
- Dr. Jenny Bryan's ["How to get unstuck"](https://progdata.netlify.com/help-general/) page is useful for getting help online.


## Making a GitHub Repository

We will be using [GitHub](https://github.com) a lot in this course.

GitHub is similar to Dropbox, OneDrive, or other cloud storage services.
There are 3 key benefits of GitHub compared to those other services.

  1. GitHub is a _version control_ platform. 
     It is designed to **track** exactly **what changes you make** and **when you make them**.
     You can browse the history 
  2. GitHub is designed for code.
     You can track what changes you make **line by line**
     You can integrate your code with automated tools for error checking, testing, etc.
  3. GitHub is designed for _collaborative coding_.
     
       - One master copy
       - People can make simultaneous edits
       - No emailing files back and forth
       - Tools for checking and verifying each other's code
       
     We will practice using GitHub for collaboration through the weekly homework.
     
Let's make a GitHub repository that you will use for this class.
Follow this link: <https://classroom.github.com/a/bUKffmtV>

This will create a repository for you or take you to your existing repository.

     
## Navigating a GitHub Repository

Let's practice some vocabulary.

  1. You each have a GitHub **account**.
  1. You each have made a homework **repository** or **repo**.
  
     - A repository can be *public* or *private*.
     - You can have many repositories for your account.
     - It's a good idea to **one repository for each project**.
     - (Sign up for the GitHub Student Pack to get free unlimited private repositories.)
     
  1. A repo can contain many files and folers (or "directories").
  1. When you make a change to a file in your repo, this is called **committing** a change (or making a **commit**).
  
Let's take a look at various parts of a GitHub repo.

  1. Files/folders ("code")
  1. History
  1. Issues
  1. Branches
  1. Pull requests

Let's practice editing a file with GitHub.
Make a new file on your participation repository and edit it:

    - Click on the "Create New File" button on your repository's home page.
    - Call it `navigating_github.md`
    - Write something (e.g., what's your favorite color?). 
    - Commit ("save") the file by clicking on green "commit new file" button at the bottom of the page.
    - Now type something else (e.g., what's your favorite animal?) and commit the change.
    
Now look at your commit history in the "History" tab.
  
You can download a copy of your repository to your computer (**cloning** it), make changes (commits) there, then **push** them back to GitHub.
You do this with a **git client** application, such as the one provided by GitHub: [GitHub for Desktop](https://desktop.github.com)

After GitHub for Desktop is installed, you can clone the repo to your computer using the big green "Code" button on the GitHub page.
You can also clone a repository and work with it directly in RStudio.
Let's do that now.


## RStudio Projects

In RStudio, click File → New Project… → Version Control → Git. In the popup:

  1. Enter the URL for your GitHub repository
  1. Choose where you want the folder to be stored on your computer
  1. Give the folder (directory) an understandable name
  
This will do two things:
  1. Download ("clone") the GitHub repo to your computer and start tracking it
  1. Create an RStudio Project file

### The working directory

When you open R, it "runs" in some folder on your computer. 
This is the place it will look for files to import and write files as output. 
Think about where your Rmd output files end up when you knit them.

If you have R/RStudio closed, and you open a .R or .Rmd file, R/RStudio will start in the folder holding that file.

If you open R/RStudio from the Windows Start menu, the Mac dock, the Mac Spotlight, etc., R/Studio will start in its default location (probably your user home directory, see Tools → Global Options → General → Default working directory…).

When I say "R/Studio will start in…", what I am referring to is R's "working directory". 
Like I say above, this is the place R will look for files to import and write files as output. 
You can check what R's current working directory is using the `getwd()` function:

```{r}
getwd()
```

You can also change the working directory using the `setwd()` function:

```{r, eval = FALSE}
setwd(file.path("path", "to", "folder"))
```

Do not use `setwd()`! 
You should always write your R scripts so that the entire project is self-contained in a folder. 
All of the scripts, folders, data, output, etc. should all "live" within this project folder. 

We will talk a lot about how to do this throughout the semester.
For now, we will start by working with RStudio Projects to make this easier.

When you double click on a .Rproj file, it:

  1. Opens a new fresh R session, with
  2. The working directory set to the location of the .Rproj file, and
  3. No connection whatsoever to any other R sessions you already have open
  
You can also set specfic options for each RStudio project (e.g., number of spaces to insert when you type Tab, etc.).

Let's practice closing RStudio and re-opening it by opening the RStudio project.
Run `getwd()` to see where R is running. 


## The Version Control Workflow

Now, let's practice the workflow to work with your files with GitHub.

### Editing a file and making a commit

Open the `README.md` file in your local git folder by clicking on it in the Files pane. 
`README.md` is a special file that will show when viewing a folder on GitHub.
Use README files to describe the contents of a folder and what's going on there.

Type "Hello world" and save the file.

Now, open the Git tab on the right hand side of the RStudio window. 

This pane shows you the files in the git fold that **have changed since the last commit**. 
You can view a detailed list of changes 



Before we dive into concepts, it's important to distinguish between the __local__ 
and __remote__ copies of a repo.

- __Local__ refers to things on your own computer. A local repo is a repo found on your hard drive.
- __Remote__ refers to things on the internet. A remote repo lives on GitHub (or other similar sites). 

You can connect a local repo to a remote repo, then push and pull ("fetch") changes
between them. You have already been doing this using the GitHub Desktop program.

Note that you can connect your local repo to more than one remote repo! 
Because of this, git gives the remote repos names (e.g., `origin`, `upstream`). 
In this class, we will only ever be using one remote. By default, this remote is 
named __origin__. 


### The typical workflow (8 min)

The majority of your interaction with version control will be a 
**pull/stage/commit/push workflow**, explained here. For another resource on 
this, check out [happygitwithr: rstudio-git-github](http://happygitwithr.com/rstudio-git-github.html).

0. __Clone__ your repository if you don't have a local copy.

Once you have a local copy of the repository, then working on a project involves 
frequent use of these three steps:

1. __Pull__ the remote repo to make sure your local copy is up to date.
2. Make changes to your files.
   1. __Stage__ your changes (GitHub Desktop does this for you).
3. __Commit__ your changes.
4. __Push__ the changes (after perhaps pulling again).

Git treats the remote repository as the "official" version of the repository. 
This means that your local copy is a second class citizen -- the repository you 
have locally must be up-to-date with the remote repository before you are 
allowed to push your work. If there are commits on the remote repository that 
are not present locally, git will throw an error if you try to push your changes.

**Integrate version control as you do work!**

Keep track of your changes by committing them frequently as you go, rather than
waiting until the end.

- Workflow without version control: save your files spontaneously.
- Workflow with version control: 
  - save your files spontaneously, 
  - commit your changes after every "step" in your work, and 
  - push your changes [in case of fire](https://github.com/louim/in-case-of-fire). 

Committing often ensures that you can trace back all the work you did. 
This results in transparency with the way your project has developed, 
which is a very effective workflow. 

You might feel self-conscious about half-finished work being viewable.
Try to push past that. Folks aren't going to judge you based on in-progress work.



### Git Clients (3 min)

We have been using the GitHub Desktop program ("client") to work with git. 
It's also possible to work with git directly from RStudio (see the bottom of this
page) or using other programs. You can also "directly" interact with git, by
typing commands in the terminal (cmd, Terminal, bash), such as `git clone`, 
`git commit`, etc. Working in the terminal opens a lot of extra functionality
with git, but the GitHub Desktop program will get us most of what we need.


### Merge conflicts (5 min)

If you change a file locally, and that same file (_and_ the same lines) get 
changed on the remote repo in a different way, you'll end up with a _merge conflict_.

You will need to resolve this conflict before you can continue working. Remember 
that your local copy is a second class citizen compared to the remote version, 
so you'll have to resolve things locally before pushing to the remote. 

### Merge conflicts: Activity (5 min)

Let's make a merge conflict, then fix it. 

1. Edit a line of your README both locally and remotely (on GitHub) to something 
   different in both cases. Commit both changes.
2. Try pulling your remote changes. You'll get a _merge conflict_. 
3. Update the file that has the conflict, commit your changes, and push.


### Branching (8 min)

Sometimes, it's a good idea to work on changes to one part of your code separately
before putting them back into your master document. For example, let's say you
want to experiment with a new analysis without messing up your existing work.

To do that, we use **branches**. A branch is a copy of the repo that sits separately
from your `master` branch. Git keeps track of how each of your branches differs.
  - When did a branch break off from `master`?
  - What commits have been made to the branch since the break?
  - What commits have been made to `master` since the break?
  
Let's take a look at some branches on the [psychmeta repo](https://github.com/psychmeta/psychmeta).

After you make changes to the branch, at some point, you probably want to **merge**
the branch back into `master`. On GitHub, we do this using a **pull request**.
  - That name means you want the parent branch (`master`) to _pull_ in all the 
    commits made on child branch. You _request_ that this happens from the 
    owners or collaborators on the repo (for your homework, this is yourself).
  - Once a pull request has been opened, it's a good time to review the changes
    to the code, run tests, make comments, and correct any errors. You can review
    yourself and also request code reviews from others by username.
  - You can make additional changes to the pull request by pushing more commits
    to the child branch.
  - When you are ready, **merge** the pull request into the parent branch.
  - [Example from psychmeta](https://github.com/psychmeta/psychmeta/pull/75).
  - For more info on pull requests, see this [GitHub tutorial](https://help.github.com/articles/about-pull-requests/).

There are many reasons you may want to branch. Here are some:

- A collaborator wants to make a change to the repo, but the end product of the 
  change requires review from collaborators.
- You want to make changes, but don't want to "deploy" the changes until later 
  (such as if pushing to GitHub triggers a website build).
- If you want to try something "risky", it's just safer to work on a branch.

### Branching: Activity (5 min)

Let's organize our participation repo in a branch.

1. Create a new branch locally, called "organizing" (we could have also made this on GitHub):
    - Click the "Branch" button ![](./img/branch.png) in GitHub Desktop.
    - Type a name for your branch and click "New Branch".
2. Stage and commit the new files.
3. Restructure your repository in a more sensible way, using some folders (locally).
4. Stage and commit the changes; push to GitHub.
5. Explore: 
    - Switch between branches to see that the repo structure is different.
6. Merge the branch to "master" via GitHub by making a pull request. 


### Undoing Changes (5 min)

There are many ways that work can be "undone" in git. We will only investigate 
three of the simpler methods. For more advanced methods, like reverting to a specific
previous commit in your repo history, check out these resources by 
[bitbucket](https://www.atlassian.com/git/tutorials/undoing-changes) and 
[GitHub](https://blog.github.com/2015-06-08-how-to-undo-almost-anything-with-git/). 


The three most useful "undo"s are:

1. Undoing your (uncommited) work and reverting to the previous commit.
2. Reverting a single previous commit.
3. Browsing the repo at previous states, and taking files from there. 

We'll demonstrate (1) and (2) in an activity.

### Undoing Changes: Activity (2 min)

Here's how to go back to the most recent commit:

1. First, make and save a change to (say) a README file in your participation repo.
2. In GitHub desktop, right-click on the file whose changes you want to discard.
   Click "Discard Changes". You can even select multiple files at once if you like.
   
Here's how to undo a specific previous commit:

1. In GitHub desktop, click on the History tab.
2. Right-click on the commit you want to revert and choose "Revert this commit".


### Getting weird errors? (3 min)

It's common to sometimes experience some errors in git, especially if you're first 
learning how to use it. Try to get yourself unstuck with the concepts we've discussed here first. 

But, you might find yourself stuck. The git documentation is full of jargon, 
making it difficult to read and therefore difficult to debug things. There's even 
a [parody](https://git-man-page-generator.lokaltog.net/) on it. If you are in 
this position, it's best to just [burn it all down](http://happygitwithr.com/burn.html). 
There's even an [xkcd comic](https://xkcd.com/1597/) on this.


### Tagging a Release (5 min)

Tagging a release on GitHub is like putting a "star" next to a particular commit. 
It highlights a particular point in time of your repository that is noteworthy, 
typically after achieving some milestone. This is easier to come back to than 
having to manually keep track of noteworthy points in your commit history.

Examples:

- At the end of teaching this class, I will tag a release so I can easily come back
  to earlier versions of the course in the future.
- After sufficient development of an R package like [psychmeta](https://github.com/psychmeta/psychmeta/releases), 
  a new release is tagged corresponding to the version of the package. 

### Tagging a Release: Activity (3 min)

Congratulations! We finished the first two weeks of DataSci and Programming, 
which focussed on _tools_. To mark this milestone, let's tag a release on our 
participation repositories.

1. On your GitHub repo online, click "Releases"
2. Click "Create a new release"
3. Fill in the fields:
    - It probably makes sense to use a versioning system like `week_2` here.
4. "Publish Release".


## This week's homework

### Assignment

The assignment is posted on the [Assignments page](https://wiernik-datasci.netlify.com/evaluation/assignments/) 
of the course website.

Your tasks are to create 3 products:
  1. A README.md file for your homework repository to introduce yourself
     and show off some Markdown formatting skills.
  2. An RMarkdown document exploring a dataset, such as `gapminder::gapminder`
     or `psych::bfi`.
  3. An RMarkdown presentation that formats your dataset exploration as a set
     of slides instead a document.

- Follow the instructions in the HW01 description carefully. 
- Commit your code to your homework repo on GitHub **on a new branch called `hw01`**. 
- When you are ready for your peer review (by Monday at 23:59!), create a 
  **Pull Request** to prepare to merge this branch back into your `master` branch.
- Request code reviews from the 2 people assigned to you (see the 
  [Peer Review page](https://wiernik-datasci.netlify.com/evaluation/hw01/pr01/)).
- Submit your peer reivews to your classmat by Tuesday at 23:59.
- Merge your homework branch back into `master` and tag a release called `hw01` 
  by Wednesday at 23:59.


## Optional: Work with git in RStudio

It's possible to work with git/GitHub directly in RStudio, rather than using
GitHub Desktop. I usually work with GitHub Desktop, but do whatever works for you.
I can help you get RStudio working with git if you need a hand.

You might need to [configure your git](http://happygitwithr.com/hello-git.html) 
using the command line or the `usethis` package.

Your RStudio will probably be able to "find" git. But if it can't, you'll 
encounter errors. See [happygitwithr: see-git](http://happygitwithr.com/rstudio-see-git.html) 
for help. 

__Optional__ (but recommended): If you are on a laptop, after class, you might 
want to [cache](http://happygitwithr.com/credential-caching.html) 
your credentials so that you don't have to keep inserting your password.

### The typical workflow git in RStudio

Let's make a change to our repository from local.  

1. Cloning your participation repo.
    - In RStudio, File -> New Project -> Version Control -> Git.
    - You should see a `Git` tab in RStudio, upper-right corner window. 
      If not, see [happygitwithr: see-git](http://happygitwithr.com/rstudio-see-git.html) 
      for help.
    - Take a look at the files you just downloaded!
2. Make your README a little nicer. Maybe fix up the title.
3. Stage and commit the changes:
    - In the Git tab in RStudio, click the checkboxes for the files that you 
      want to commit. This is called "staging".
    - Click the "Commit" button.
    - Enter a commit message.
    - Click "commit". 
4. Push to your remote repository (which is named "origin")
    - Click the up arrow in the Git panel in RStudio.

<!-- 
# Leftover text.

3. Commit your changes. 

Notice that GitHub automatically displays markdown files nicely, but not HTML files.

Note: this exercise employs an effective _local_ git workflow, which we will 
address later on in class.

Together:

1. If you haven't already, clone your participation repository to your desktop.
2. In RStudio, open the file `navigating_github.md`.
    - Yes! RStudio also acts as a plain text editor!
3. Convert the `.md` file to both pdf and html by clicking the `Preview` or `Knit` button.
4. Commit the two new files and push them to GitHub.
-->
